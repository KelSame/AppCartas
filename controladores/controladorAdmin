const Carta = require('../modelos/carta');
const Sobre = require('../modelos/sobre');
const Usuario = require('../modelos/usuario');

// 🎁 Crear sobres para un usuario
exports.crearSobres = async (req, res) => {
  try {
    const { usuarioId, cantidad } = req.body; // adminId ya fue validado antes

    const sobres = await Sobre.findOneAndUpdate(
      { usuarioId },
      { $inc: { cantidad } },
      { upsert: true, new: true }
    );

    res.status(200).json({ mensaje: '✅ Sobres otorgados', sobres });
  } catch (error) {
    console.error('❌ Error al otorgar sobres:', error);
    res.status(500).json({ error: 'Error al otorgar sobres' });
  }
};

// 💰 Otorgar monedas a un usuario
exports.otorgarMonedas = async (req, res) => {
  try {
    const { usuarioId, monto } = req.body; // adminId validado

    const usuario = await Usuario.findOneAndUpdate(
      { usuarioId },
      { $inc: { monto } },
      { new: true }
    );

    res.status(200).json({ mensaje: '✅ Monedas otorgadas', usuario });
  } catch (error) {
    console.error('❌ Error al otorgar monedas:', error);
    res.status(500).json({ error: 'Error al otorgar monedas' });
  }
};

// ✨ Crear carta para un usuario
exports.crearCarta = async (req, res) => {
  try {
    const { usuarioId, nombre, alias, rareza, cantidad } = req.body;

    const carta = await Carta.create({
      usuarioId,
      nombre,
      alias,
      rareza,
      cantidad,
    });

    res.status(200).json({ mensaje: '✅ Carta creada', carta });
  } catch (error) {
    console.error('❌ Error al crear carta:', error);
    res.status(500).json({ error: 'Error al crear carta' });
  }
};

// 🗑 Eliminar una carta por ID
exports.eliminarCarta = async (req, res) => {
  try {
    const { cartaId } = req.body; // adminId validado

    await Carta.findByIdAndDelete(cartaId);

    res.status(200).json({ mensaje: '✅ Carta eliminada correctamente' });
  } catch (error) {
    console.error('❌ Error al eliminar carta:', error);
    res.status(500).json({ error: 'Error al eliminar carta' });
  }
};

